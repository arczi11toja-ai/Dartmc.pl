# code.txt

def start(token, config, log):
    log("[CORE] Startuje logika")

    import discord
    from discord.ext import commands
    from discord import app_commands
    import asyncio
    import random

    intents = discord.Intents.default()
    intents.message_content = True
    intents.members = True

    bot = commands.Bot(command_prefix=config["prefix"], intents=intents)

    tree = bot.tree

    VERIFIED_ROLE_ID = config.get("verified_role_id")
    TICKET_CATEGORY_ID = config.get("ticket_category_id")

    # =============================
    # READY
    # =============================
    @bot.event
    async def on_ready():
        await tree.sync()
        log(f"[CORE] Zalogowano jako {bot.user}")

    # =============================
    # WERYFIKACJA
    # =============================
    class VerifyView(discord.ui.View):
        @discord.ui.button(label="âœ… Zweryfikuj siÄ™", style=discord.ButtonStyle.green)
        async def verify(self, interaction: discord.Interaction, button: discord.ui.Button):
            role = interaction.guild.get_role(VERIFIED_ROLE_ID)
            if role:
                await interaction.user.add_roles(role)
                await interaction.response.send_message("âœ… Zweryfikowano!", ephemeral=True)

    @tree.command(name="menuweryfikacja", description="Panel weryfikacji")
    async def menuweryfikacja(interaction: discord.Interaction):
        embed = discord.Embed(
            title="ğŸ” Weryfikacja",
            description="Kliknij przycisk aby siÄ™ zweryfikowaÄ‡",
            color=0x2ecc71
        )
        await interaction.response.send_message(embed=embed, view=VerifyView())

    # =============================
    # TICKETY
    # =============================
    class TicketSelect(discord.ui.Select):
        def __init__(self):
            options = [
                discord.SelectOption(label="Pomoc", emoji="ğŸ› ï¸"),
                discord.SelectOption(label="WspÃ³Å‚praca", emoji="ğŸ¤"),
                discord.SelectOption(label="Inne", emoji="ğŸ“©")
            ]
            super().__init__(placeholder="Wybierz typ ticketa", options=options)

        async def callback(self, interaction: discord.Interaction):
            category = interaction.guild.get_channel(TICKET_CATEGORY_ID)
            channel = await interaction.guild.create_text_channel(
                f"ticket-{interaction.user.name}",
                category=category
            )
            await channel.send(f"{interaction.user.mention} ğŸ« Ticket utworzony")
            await interaction.response.send_message("âœ… Ticket utworzony!", ephemeral=True)

    class TicketView(discord.ui.View):
        def __init__(self):
            super().__init__()
            self.add_item(TicketSelect())

    @tree.command(name="menuticket", description="Panel ticketÃ³w")
    async def menuticket(interaction: discord.Interaction):
        embed = discord.Embed(
            title="ğŸ« Tickety",
            description="Wybierz powÃ³d kontaktu",
            color=0x3498db
        )
        await interaction.response.send_message(embed=embed, view=TicketView())

    # =============================
    # OGÅOSZENIA
    # =============================
    @tree.command(name="ogÅ‚oszenie", description="WyÅ›lij ogÅ‚oszenie")
    @app_commands.describe(tytuÅ‚="TytuÅ‚", treÅ›Ä‡="TreÅ›Ä‡ ogÅ‚oszenia")
    async def ogloszenie(interaction: discord.Interaction, tytuÅ‚: str, treÅ›Ä‡: str):
        embed = discord.Embed(title=tytuÅ‚, description=treÅ›Ä‡, color=0xf1c40f)
        embed.set_footer(text="ğŸ“¢ OgÅ‚oszenie")
        await interaction.response.send_message(embed=embed)

    # =============================
    # KONKURSY
    # =============================
    @tree.command(name="konkurs", description="UtwÃ³rz konkurs")
    @app_commands.describe(
        nagroda="Co do wygrania",
        czas="Czas w sekundach",
        wygrani="Ilu wygranych"
    )
    async def konkurs(
        interaction: discord.Interaction,
        nagroda: str,
        czas: int,
        wygrani: int
    ):
        embed = discord.Embed(
            title="ğŸ‰ KONKURS!",
            description=f"ğŸ† Nagroda: **{nagroda}**\nâ±ï¸ Czas: **{czas}s**\nğŸ‘¥ Wygrani: **{wygrani}**",
            color=0xe84393
        )

        msg = await interaction.response.send_message(embed=embed)
        message = await interaction.original_response()
        await message.add_reaction("ğŸ‰")

        await asyncio.sleep(czas)

        message = await message.channel.fetch_message(message.id)
        users = [u async for u in message.reactions[0].users() if not u.bot]

        if not users:
            await message.channel.send("âŒ Brak uczestnikÃ³w")
            return

        winners = random.sample(users, min(wygrani, len(users)))
        await message.channel.send(
            "ğŸŠ Wygrali: " + ", ".join(w.mention for w in winners)
        )

    bot.run(token)
